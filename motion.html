<!DOCTYPE html>
<html>
<head>
<title>Game</title>

<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    
<script src="js/jquery-3.1.0.min.js"></script>
<script src="js/bootstrap.js"></script>
<link href="css/bootstrap.css" rel="stylesheet" />

<script type="text/javascript" charset="utf-8">

    //var xhttp = new XMLHttpRequest();
    //xhttp.onreadystatechange = function () {
    //    if (this.readyState == 4 && this.status == 200) {
    //        xml_start(this);
    //    }
    //};
    //xhttp.open("GET", "scoring.xml", true);
    //xhttp.send();

    //var xmlDoc;

    //function xml_start(xml) {
    //    xmlDoc = xml.responseXML;
    //}

    document.addEventListener("deviceready", onDeviceReady, false);

    function onDeviceReady() {
        setInterval(function () {
            navigator.accelerometer.getCurrentAcceleration(onSuccess, onError);
        }, "10");
    }

    function onSuccess(acceleration) {
        var pl = document.getElementById("player");

        var w = window.screen.width;
        var h = window.screen.height;

        var txt = "";

        var myx = pl.offsetLeft;
        var myy = pl.offsetTop;

        txt += 'x=' + (myx - acceleration.x) + '<br> y=' + (myy + acceleration.y);

        txt += '<br><br>myx=' + myx + '<br>myy=' + myy;

        txt += '<br> <br>w=' + w + ' h=' + h;

        if (myx < 0) {
            pl.style.left = (0) + 'px';
        }
        else if (myx > 320) {
            pl.style.left = (320) + 'px';
        }
        else {
            pl.style.left = (myx - (acceleration.x)) + 'px';
        }

        if (myy < 0) {
            pl.style.top = (0) + 'px';
        }
        else if (myy > 600) {
            pl.style.top = (600) + 'px';
        }
        else {
            pl.style.top = (myy + (acceleration.y)) + 'px';
        }

    }
    // onError: Failed to get the acceleration
    //
    function onError() {
        alert('onError!');
    }

    function falling(ele, speed)
    {
        setInterval(function () {
            var en = ele;
            var y = en.offsetTop;
            var ran;

            if (y == 640) {
                ran = Math.random() * 300;
                en.style.top = (0) + 'px';
            }
            else
                en.style.top = (y + 1) + 'px';

            en.style.left = (ran) + 'px';

        }, speed);
    }

    function collision()
    {
        var enims = document.getElementsByClassName("enemy");
        var i;

        var pl = document.getElementById("player");
        var px = pl.offsetLeft;
        var py = pl.offsetTop;

        var ex, ey;

        scoring();

        for (i = 0; i < enims.length; i++)
        {
            ex = enims[i].offsetLeft;
            ey = enims[i].offsetTop;

            if ((px > (ex - 40) && px < (ex + 80)))
            {
                if ((py > (ey - 40) && py < (ey + 80))) {
                    //var xelem = xmlDoc.getElementsByTagName('score');
                    //xelem[0].setAttribute("hs", high_score);
                    window.open("game_over.html", "_self"); //collision happens here
                }
            }
        }
    }

    function scoring()
    {
        score++;

        if (high_score < score)
            high_score = score;

        document.getElementById("hs").innerHTML = "High Score:" + high_score;
        document.getElementById("scr").innerHTML = "Score" + score;
    }

    function start_game()
    {
        //var xelem = xmlDoc.getElementsByTagName('book');

        //high_score = xelem[0].getAttribute("category");

        //alert(high_score);

        falling(document.getElementById("enem1"), "2");
        falling(document.getElementById("enem2"), "5");
        falling(document.getElementById("enem3"), "7");
        falling(document.getElementById("enem4"), "12");

        setInterval(function () {
            collision();
        }, "1");
    }

    $(document).ready(function () {
        start_game();
    });

    var high_score;
    var score = 0;

</script>
    
<style>
    #player {
        width:40px;
        height:40px;
        background-color:#555;
        border-radius:40px;
        position: absolute;
        top:550px;
        left:150px;
    }

    .enemy {
        width:80px;
        height:80px;
        background-color:red;
        position:absolute;
    }

    #enem1 {
        top:0px;
        left:0px;
    }

    #enem2 {
        top:0px;
        left:80px;
    }

    #enem3 {
        top:0px;
        left:200px;
    }

    #enem4 {
        top:0px;
        left:280px;
    }

</style>
</head>
<body>
    <div id="hs">High Score: </div>
    <br />
    <div id="scr">Score: </div>
    <div id="player"></div>
    <div id="enem1" class="enemy">1</div>
    <div id="enem2" class="enemy">2</div>
    <div id="enem3" class="enemy">3</div>
    <div id="enem4" class="enemy">4</div>
</body>
</html>
